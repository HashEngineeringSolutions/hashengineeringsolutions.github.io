<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>How to test applications</title>
<link rel="icon" type="image/png" href="/favicon16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon32.png" sizes="32x32">
<link rel="stylesheet" type="text/css" href="/css/main.css" />
<script type="text/javascript" src="/js/main.js"></script>
</head>
<body>

<div class="headercontainer"><div class="header">
<a href="/" class="logo"><img src="/img/bitcoinjlogo.svg"></a>
<ul class="menu" id="menu">
  <li><a href="/#introduction">Introduction</a></li>
  <li><a href="/#getting-started">Getting started</a></li>
  <li><a href="/#documentation">Documentation</a></li>
  <li><a href="/#community">Community</a></li>
</ul>
</div></div>

<div class="content">
  <div id="toc" class="toc">
  <div>

<ul id="markdown-toc">
  <li><a href="#the-testnet">The testnet</a></li>
  <li><a href="#regression-test-mode">Regression test mode</a></li>
  <li><a href="#unit-tests">Unit tests</a></li>
</ul>

  </div>
</div>

<div class="toccontent">

  <h1 id="how-to-test-applications">How to test applications</h1>

  <p>Testing is obviously an important step for any software that uses money. This article explains some common techniques used to test BItcoin apps.</p>

  <h2 id="the-testnet">The testnet</h2>

  <p>The Bitcoin community runs a separate, parallel instance of the Bitcoin network that features a slightly different and more relaxed ruleset, called the <em>testnet</em>. Most usefully, coins on the testnet have no value and can be obtained for free from testnet faucet sites like <a href="http://faucet.xeno-genesis.com/">http://faucet.xeno-genesis.com/</a> or <a href="http://tpfaucet.appspot.com/">http://tpfaucet.appspot.com/</a>.</p>

  <p>You can make your app use the testnet by instantiating your objects with <code>TestNetParams.get()</code> instead of <code>MainNetParams.get()</code>. The wallet-tool app accepts a flag <code>--net=TEST</code> as well.</p>

  <h2 id="regression-test-mode">Regression test mode</h2>

  <p>The testnet is good as far as it goes, but it still has the issue that blocks are mined every ten minutes. Often you don’t want to wait for a new block, and you don’t want to have to use faucet sites to get test coins.</p>

  <p>To simplify things, starting from Bitcoin Core 0.9 there is a new mode called regtest mode. You can run a local bitcoind in regtest mode like this:</p>

  <pre><code>./bitcoind -regtest
</code></pre>

  <p>and once that’s running, in another window you can do something like</p>

  <pre><code>./bitcoin-cli -regtest setgenerate true 101
</code></pre>

  <p>… to create a new block on demand. Regtest mode requires the usage of yet another set of network params, <code>RegTestParams.get()</code>, and is designed to run only locally. There is no public regtest network. You can use <code>PeerGroup.connectToLocalHost()</code> to make it talk to the local bitcoind.</p>

  <p>Note that newly mined coins have to mature (this is a general Bitcoin rule). This means they don’t become spendable for 100 blocks. The number 101 in the command above selects how many blocks to mine. Thus this should give you spendable coins. Then you can send some test coins to your app like this:</p>

  <pre><code>./bitcoin-cli -regtest sendtoaddress &lt;address of your app goes here&gt; 10.0
./bitcoin-cli -regtest setgenerate true 1
</code></pre>

  <p>The block chain and so on is stored in ~/.bitcoin/regtest, so you can delete it to start over again, or use -datadir to make the files be saved in a different location.</p>

  <p>You can make wallet-tool use this mode using <code>--net=REGTEST --peers=localhost</code>.</p>

  <p>Currently bitcoinj doesn’t have a class that wraps the Bitcoin Core RPC interface and drives regtest mode, but it’d be a nice feature to have in future.</p>

  <h2 id="unit-tests">Unit tests</h2>

  <p>Bitcoinj provides a <code>TestUtils</code> class that can do things like manufacture fake <code>Transaction</code> objects and so on. Take a look at the test suite for bitcoinj itself to see how to use the utilities. Unit tests are a great way to build robustness in your software, although due to the many subtle complexities of the Bitcoin protocol they’re not always sufficient to ensure things work correctly.</p>

</div>

</div>
</body>

<script>fallbackSVG();</script>
<script>updateToc();</script>

</html>
