<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_39) on Fri Apr 25 14:06:46 CEST 2014 -->
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<TITLE>
PaymentChannelServerState (bitcoinj 0.11.2 API)
</TITLE>

<META NAME="date" CONTENT="2014-04-25">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="PaymentChannelServerState (bitcoinj 0.11.2 API)";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/PaymentChannelServerState.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerListener.HandlerFactory.html" title="interface in com.google.bitcoin.protocols.channels"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.State.html" title="enum in com.google.bitcoin.protocols.channels"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../index.html?com/google/bitcoin/protocols/channels/PaymentChannelServerState.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="PaymentChannelServerState.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;<A HREF="#nested_class_summary">NESTED</A>&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
com.google.bitcoin.protocols.channels</FONT>
<BR>
Class PaymentChannelServerState</H2>
<PRE>
<A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</A>
  <IMG SRC="../../../../../resources/inherit.gif" ALT="extended by "><B>com.google.bitcoin.protocols.channels.PaymentChannelServerState</B>
</PRE>
<HR>
<DL>
<DT><PRE>public class <B>PaymentChannelServerState</B><DT>extends <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A></DL>
</PRE>

<P>
<p>A payment channel is a method of sending money to someone such that the amount of money you send can be adjusted
 after the fact, in an efficient manner that does not require broadcasting to the network. This can be used to
 implement micropayments or other payment schemes in which immediate settlement is not required, but zero trust
 negotiation is. Note that this class only allows the amount of money received to be incremented, not decremented.</p>

 <p>This class implements the core state machine for the server side of the protocol. The client side is implemented
 by <A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelClientState.html" title="class in com.google.bitcoin.protocols.channels"><CODE>PaymentChannelClientState</CODE></A> and <A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerListener.html" title="class in com.google.bitcoin.protocols.channels"><CODE>PaymentChannelServerListener</CODE></A> implements the server-side network
 protocol listening for TCP/IP connections and moving this class through each state. We say that the party who is
 sending funds is the <i>client</i> or <i>initiating party</i>. The party that is receiving the funds is the
 <i>server</i> or <i>receiving party</i>. Although the underlying Bitcoin protocol is capable of more complex
 relationships than that, this class implements only the simplest case.</p>

 <p>To protect clients from malicious servers, a channel has an expiry parameter. When this expiration is reached, the
 client will broadcast the created refund  transaction and take back all the money in this channel. Because this is
 specified in terms of block timestamps, it is fairly fuzzy and it is possible to spend the refund transaction up to a
 few hours before the actual timestamp. Thus, it is very important that the channel be closed with plenty of time left
 to get the highest value payment transaction confirmed before the expire time (minimum 3-4 hours is suggested if the
 payment transaction has enough fee to be confirmed in the next block or two).</p>

 <p>To begin, we must provide the client with a pubkey which we wish to use for the multi-sig contract which locks in
 the channel. The client will then provide us with an incomplete refund transaction and the pubkey which they used in
 the multi-sig contract. We use this pubkey to recreate the multi-sig output and then sign that to the refund
 transaction. We provide that signature to the client and they then have the ability to spend the refund transaction
 at the specified expire time. The client then provides us with the full, signed multi-sig contract which we verify
 and broadcast, locking in their funds until we spend a payment transaction or the expire time is reached. The client
 can then begin paying by providing us with signatures for the multi-sig contract which pay some amount back to the
 client, and the rest is ours to do with as we wish.</p>
<P>

<P>
<HR>

<P>
<!-- ======== NESTED CLASS SUMMARY ======== -->

<A NAME="nested_class_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Nested Class Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;class</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.State.html" title="enum in com.google.bitcoin.protocols.channels">PaymentChannelServerState.State</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The different logical states the channel can be in.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#PaymentChannelServerState(com.google.bitcoin.core.TransactionBroadcaster, com.google.bitcoin.core.Wallet, com.google.bitcoin.core.ECKey, long)">PaymentChannelServerState</A></B>(<A HREF="../../../../../com/google/bitcoin/core/TransactionBroadcaster.html" title="interface in com.google.bitcoin.core">TransactionBroadcaster</A>&nbsp;broadcaster,
                          <A HREF="../../../../../com/google/bitcoin/core/Wallet.html" title="class in com.google.bitcoin.core">Wallet</A>&nbsp;wallet,
                          <A HREF="../../../../../com/google/bitcoin/core/ECKey.html" title="class in com.google.bitcoin.core">ECKey</A>&nbsp;serverKey,
                          long&nbsp;minExpireTime)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Creates a new state object to track the server side of a payment channel.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;com.google.common.util.concurrent.ListenableFuture&lt;<A HREF="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</A>&gt;</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#close()">close</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Closes this channel and broadcasts the highest value payment transaction on the network.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#getBestValueToMe()">getBestValueToMe</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gets the highest payment to ourselves (which we will receive on settle(), not including fees)</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#getFeePaid()">getFeePaid</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gets the fee paid in the final payment transaction (only available if settle() did not throw an exception)</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#getMultisigContract()">getMultisigContract</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gets the multisig contract which was used to initialize this channel</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;long</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#getRefundTransactionUnlockTime()">getRefundTransactionUnlockTime</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gets the client's refund transaction which they can spend to get the entire channel value back if it reaches its
 lock time.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.State.html" title="enum in com.google.bitcoin.protocols.channels">PaymentChannelServerState.State</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#getState()">getState</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This object implements a state machine, and this accessor returns which state it's currently in.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#incrementPayment(java.math.BigInteger, byte[])">incrementPayment</A></B>(<A HREF="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</A>&nbsp;refundSize,
                 byte[]&nbsp;signatureBytes)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Called when the client provides us with a new signature and wishes to increment total payment by size.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;com.google.common.util.concurrent.ListenableFuture&lt;<A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html" title="class in com.google.bitcoin.protocols.channels">PaymentChannelServerState</A>&gt;</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#provideMultiSigContract(com.google.bitcoin.core.Transaction)">provideMultiSigContract</A></B>(<A HREF="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</A>&nbsp;multisigContract)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Called when the client provides the multi-sig contract.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;byte[]</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#provideRefundTransaction(com.google.bitcoin.core.Transaction, byte[])">provideRefundTransaction</A></B>(<A HREF="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</A>&nbsp;refundTx,
                         byte[]&nbsp;clientMultiSigPubKey)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Called when the client provides the refund transaction.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#storeChannelInWallet(com.google.bitcoin.protocols.channels.PaymentChannelServer)">storeChannelInWallet</A></B>(<A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html" title="class in com.google.bitcoin.protocols.channels">PaymentChannelServer</A>&nbsp;connectedHandler)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stores this channel's state in the wallet as a part of a <A HREF="../../../../../com/google/bitcoin/protocols/channels/StoredPaymentChannelServerStates.html" title="class in com.google.bitcoin.protocols.channels"><CODE>StoredPaymentChannelServerStates</CODE></A> wallet
 extension and keeps it up-to-date each time payment is incremented.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.<A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</A>, <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</A>, <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</A>, <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</A>, <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</A>, <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</A>, <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</A>, <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</A>, <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</A>, <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</A>, <A HREF="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</A></CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="PaymentChannelServerState(com.google.bitcoin.core.TransactionBroadcaster, com.google.bitcoin.core.Wallet, com.google.bitcoin.core.ECKey, long)"><!-- --></A><H3>
PaymentChannelServerState</H3>
<PRE>
public <B>PaymentChannelServerState</B>(<A HREF="../../../../../com/google/bitcoin/core/TransactionBroadcaster.html" title="interface in com.google.bitcoin.core">TransactionBroadcaster</A>&nbsp;broadcaster,
                                 <A HREF="../../../../../com/google/bitcoin/core/Wallet.html" title="class in com.google.bitcoin.core">Wallet</A>&nbsp;wallet,
                                 <A HREF="../../../../../com/google/bitcoin/core/ECKey.html" title="class in com.google.bitcoin.core">ECKey</A>&nbsp;serverKey,
                                 long&nbsp;minExpireTime)</PRE>
<DL>
<DD>Creates a new state object to track the server side of a payment channel.
<P>
<DL>
<DT><B>Parameters:</B><DD><CODE>broadcaster</CODE> - The peer group which we will broadcast transactions to, this should have multiple peers<DD><CODE>wallet</CODE> - The wallet which will be used to complete transactions<DD><CODE>serverKey</CODE> - The private key which we use for our part of the multi-sig contract
                  (this MUST be fresh and CANNOT be used elsewhere)<DD><CODE>minExpireTime</CODE> - The earliest time at which the client can claim the refund transaction (UNIX timestamp of block)</DL>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="getState()"><!-- --></A><H3>
getState</H3>
<PRE>
public <A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.State.html" title="enum in com.google.bitcoin.protocols.channels">PaymentChannelServerState.State</A> <B>getState</B>()</PRE>
<DL>
<DD>This object implements a state machine, and this accessor returns which state it's currently in.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="provideRefundTransaction(com.google.bitcoin.core.Transaction, byte[])"><!-- --></A><H3>
provideRefundTransaction</H3>
<PRE>
public byte[] <B>provideRefundTransaction</B>(<A HREF="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</A>&nbsp;refundTx,
                                       byte[]&nbsp;clientMultiSigPubKey)
                                throws <A HREF="../../../../../com/google/bitcoin/core/VerificationException.html" title="class in com.google.bitcoin.core">VerificationException</A></PRE>
<DL>
<DD>Called when the client provides the refund transaction.
 The refund transaction must have one input from the multisig contract (that we don't have yet) and one output
 that the client creates to themselves. This object will later be modified when we start getting paid.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>refundTx</CODE> - The refund transaction, this object will be mutated when payment is incremented.<DD><CODE>clientMultiSigPubKey</CODE> - The client's pubkey which is required for the multisig output
<DT><B>Returns:</B><DD>Our signature that makes the refund transaction valid
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../../com/google/bitcoin/core/VerificationException.html" title="class in com.google.bitcoin.core">VerificationException</A></CODE> - If the transaction isnt valid or did not meet the requirements of a refund transaction.</DL>
</DD>
</DL>
<HR>

<A NAME="provideMultiSigContract(com.google.bitcoin.core.Transaction)"><!-- --></A><H3>
provideMultiSigContract</H3>
<PRE>
public com.google.common.util.concurrent.ListenableFuture&lt;<A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html" title="class in com.google.bitcoin.protocols.channels">PaymentChannelServerState</A>&gt; <B>provideMultiSigContract</B>(<A HREF="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</A>&nbsp;multisigContract)
                                                                                                      throws <A HREF="../../../../../com/google/bitcoin/core/VerificationException.html" title="class in com.google.bitcoin.core">VerificationException</A></PRE>
<DL>
<DD>Called when the client provides the multi-sig contract.  Checks that the previously-provided refund transaction
 spends this transaction (because we will use it as a base to create payment transactions) as well as output value
 and form (ie it is a 2-of-2 multisig to the correct keys).
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>multisigContract</CODE> - The provided multisig contract. Do not mutate this object after this call.
<DT><B>Returns:</B><DD>A future which completes when the provided multisig contract successfully broadcasts, or throws if the broadcast fails for some reason
         Note that if the network simply rejects the transaction, this future will never complete, a timeout should be used.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../../com/google/bitcoin/core/VerificationException.html" title="class in com.google.bitcoin.core">VerificationException</A></CODE> - If the provided multisig contract is not well-formed or does not meet previously-specified parameters</DL>
</DD>
</DL>
<HR>

<A NAME="incrementPayment(java.math.BigInteger, byte[])"><!-- --></A><H3>
incrementPayment</H3>
<PRE>
public boolean <B>incrementPayment</B>(<A HREF="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</A>&nbsp;refundSize,
                                byte[]&nbsp;signatureBytes)
                         throws <A HREF="../../../../../com/google/bitcoin/core/VerificationException.html" title="class in com.google.bitcoin.core">VerificationException</A>,
                                <A HREF="../../../../../com/google/bitcoin/protocols/channels/ValueOutOfRangeException.html" title="class in com.google.bitcoin.protocols.channels">ValueOutOfRangeException</A>,
                                <A HREF="../../../../../com/google/bitcoin/core/InsufficientMoneyException.html" title="class in com.google.bitcoin.core">InsufficientMoneyException</A></PRE>
<DL>
<DD>Called when the client provides us with a new signature and wishes to increment total payment by size.
 Verifies the provided signature and only updates values if everything checks out.
 If the new refundSize is not the lowest we have seen, it is simply ignored.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>refundSize</CODE> - How many satoshis of the original contract are refunded to the client (the rest are ours)<DD><CODE>signatureBytes</CODE> - The new signature spending the multi-sig contract to a new payment transaction
<DT><B>Returns:</B><DD>true if there is more value left on the channel, false if it is now fully used up.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../../com/google/bitcoin/core/VerificationException.html" title="class in com.google.bitcoin.core">VerificationException</A></CODE> - If the signature does not verify or size is out of range (incl being rejected by the network as dust).
<DD><CODE><A HREF="../../../../../com/google/bitcoin/protocols/channels/ValueOutOfRangeException.html" title="class in com.google.bitcoin.protocols.channels">ValueOutOfRangeException</A></CODE>
<DD><CODE><A HREF="../../../../../com/google/bitcoin/core/InsufficientMoneyException.html" title="class in com.google.bitcoin.core">InsufficientMoneyException</A></CODE></DL>
</DD>
</DL>
<HR>

<A NAME="close()"><!-- --></A><H3>
close</H3>
<PRE>
public com.google.common.util.concurrent.ListenableFuture&lt;<A HREF="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</A>&gt; <B>close</B>()
                                                                      throws <A HREF="../../../../../com/google/bitcoin/core/InsufficientMoneyException.html" title="class in com.google.bitcoin.core">InsufficientMoneyException</A></PRE>
<DL>
<DD><p>Closes this channel and broadcasts the highest value payment transaction on the network.</p>

 <p>This will set the state to <A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.State.html#CLOSED"><CODE>PaymentChannelServerState.State.CLOSED</CODE></A> if the transaction is successfully broadcast on the network.
 If we fail to broadcast for some reason, the state is set to <A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.State.html#ERROR"><CODE>PaymentChannelServerState.State.ERROR</CODE></A>.</p>

 <p>If the current state is before <A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.State.html#READY"><CODE>PaymentChannelServerState.State.READY</CODE></A> (ie we have not finished initializing the channel), we
 simply set the state to <A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.State.html#CLOSED"><CODE>PaymentChannelServerState.State.CLOSED</CODE></A> and let the client handle getting its refund transaction confirmed.
 </p>
<P>
<DD><DL>

<DT><B>Returns:</B><DD>a future which completes when the provided multisig contract successfully broadcasts, or throws if the
         broadcast fails for some reason. Note that if the network simply rejects the transaction, this future
         will never complete, a timeout should be used.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../../com/google/bitcoin/core/InsufficientMoneyException.html" title="class in com.google.bitcoin.core">InsufficientMoneyException</A></CODE> - If the payment tx would have cost more in fees to spend than it is worth.</DL>
</DD>
</DL>
<HR>

<A NAME="getBestValueToMe()"><!-- --></A><H3>
getBestValueToMe</H3>
<PRE>
public <A HREF="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</A> <B>getBestValueToMe</B>()</PRE>
<DL>
<DD>Gets the highest payment to ourselves (which we will receive on settle(), not including fees)
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="getFeePaid()"><!-- --></A><H3>
getFeePaid</H3>
<PRE>
public <A HREF="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true" title="class or interface in java.math">BigInteger</A> <B>getFeePaid</B>()</PRE>
<DL>
<DD>Gets the fee paid in the final payment transaction (only available if settle() did not throw an exception)
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="getMultisigContract()"><!-- --></A><H3>
getMultisigContract</H3>
<PRE>
public <A HREF="../../../../../com/google/bitcoin/core/Transaction.html" title="class in com.google.bitcoin.core">Transaction</A> <B>getMultisigContract</B>()</PRE>
<DL>
<DD>Gets the multisig contract which was used to initialize this channel
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="getRefundTransactionUnlockTime()"><!-- --></A><H3>
getRefundTransactionUnlockTime</H3>
<PRE>
public long <B>getRefundTransactionUnlockTime</B>()</PRE>
<DL>
<DD>Gets the client's refund transaction which they can spend to get the entire channel value back if it reaches its
 lock time.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="storeChannelInWallet(com.google.bitcoin.protocols.channels.PaymentChannelServer)"><!-- --></A><H3>
storeChannelInWallet</H3>
<PRE>
public void <B>storeChannelInWallet</B>(<FONT SIZE="-1"><A HREF="http://docs.oracle.com/javase/6/docs/api/javax/annotation/Nullable.html?is-external=true" title="class or interface in javax.annotation">@Nullable</A></FONT>
                                 <A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html" title="class in com.google.bitcoin.protocols.channels">PaymentChannelServer</A>&nbsp;connectedHandler)</PRE>
<DL>
<DD>Stores this channel's state in the wallet as a part of a <A HREF="../../../../../com/google/bitcoin/protocols/channels/StoredPaymentChannelServerStates.html" title="class in com.google.bitcoin.protocols.channels"><CODE>StoredPaymentChannelServerStates</CODE></A> wallet
 extension and keeps it up-to-date each time payment is incremented. This will be automatically removed when
 a call to <A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.html#close()"><CODE>close()</CODE></A> completes successfully. A channel may only be stored after it
 has fully opened (ie state == State.READY).
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>connectedHandler</CODE> - Optional <A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServer.html" title="class in com.google.bitcoin.protocols.channels"><CODE>PaymentChannelServer</CODE></A> object that manages this object. This will
                         set the appropriate pointer in the newly created <A HREF="../../../../../com/google/bitcoin/protocols/channels/StoredServerChannel.html" title="class in com.google.bitcoin.protocols.channels"><CODE>StoredServerChannel</CODE></A> before it is
                         committed to wallet. If set, closing the state object will propagate the close to the
                         handler which can then do a TCP disconnect.</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/PaymentChannelServerState.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerListener.HandlerFactory.html" title="interface in com.google.bitcoin.protocols.channels"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../../com/google/bitcoin/protocols/channels/PaymentChannelServerState.State.html" title="enum in com.google.bitcoin.protocols.channels"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../../index.html?com/google/bitcoin/protocols/channels/PaymentChannelServerState.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="PaymentChannelServerState.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;<A HREF="#nested_class_summary">NESTED</A>&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>
Copyright &#169; 2014. All rights reserved.
</BODY>
</HTML>
